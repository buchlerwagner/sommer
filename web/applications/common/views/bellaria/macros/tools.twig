{% macro productItem(data, stopSale, showCategory = false, context) %}
    {% import _self as tools %}
    <div id="item-{{ data.id }}" class="shop-item col-lg-4 col-md-6 col-sm-12">
        <div class="inner-box">
            <div class="image-box">
                {% if data.variants[0].price.discount > 0 and data.variants[0].price.value > data.variants[0].price.discount %}
                <div class="sale-tag">{{ _('LBL_SALE') }}</div>
                {% endif %}
                <figure class="image">
                    <a href="{{ data.url }}">
                        <img src="{% if data.thumbnail %}{{ data.thumbnail }}{% else %}{{ context.theme }}images/no-img.png{% endif %}" alt="{{ data.name }}" title="{{ data.name }}">
                    </a>
                </figure>
                <div class="btn-box">
                    {% if data.available and not stopSale %}
                        <a href="javascript:;" class="add-to-cart" data-id="{{ data.id }}" data-variant="{{ data.variants[0].id }}" data-quantity="1"><i class="far fa-cart-plus"></i> {{ _('LBL_ADD_TO_CART') }}</a>
                    {% else %}
                        <a href="{{ data.url }}"> {{ _('LBL_VIEW_DETAILS') }}</a>
                    {% endif %}
                </div>
            </div>
            <div class="lower-content">
                <h4 class="name">
                    <a href="{{ data.url }}">{{ data.name }}</a>
                </h4>
                {% if showCategory %}
                <a href="{{ data.category.url }}">{{ data.category.name }}</a>
                {% endif %}
                {{ tools.ratingStars(data.ratings.value, data.ratings.reviews) }}
                <div class="price">
                    {% if data.variants[0].price.discount > 0 and data.variants[0].price.value > data.variants[0].price.discount  %}
                        <del>{{ _price(data.variants[0].price.value, data.variants[0].price.currency) }}</del>
                        {{ _price(data.variants[0].price.discount, data.variants[0].price.currency) }}{% if data.variants[0].packaging.packageUnitName %}/{{ data.variants[0].packaging.packageUnitName }}{% endif %}{% if data.hasVariants %}{{ _('LBL_PRICE_FROM') }}{% endif %}
                    {% else %}
                        {{ _price(data.variants[0].price.value, data.variants[0].price.currency) }}{% if data.variants[0].packaging.packageUnitName %}/{{ data.variants[0].packaging.packageUnitName }}{% endif %}{% if data.hasVariants %}{{ _('LBL_PRICE_FROM') }}{% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endmacro %}

{% macro ratingStars(value, reviews) %}
    {% if value and reviews %}
    <div class="rating">
        <span class="fa fa-star"></span>
        <span class="fa fa-star"></span>
        <span class="fa fa-star"></span>
        <span class="fa fa-star"></span>
        <span class="fa fa-star light"></span>
    </div>
    {% endif %}
{% endmacro %}

{% macro pager(data) %}
    {% if data.totalPages > 1 %}

        {% set totalPages = data.totalPages %}
        {% set pagerButtons = 8 %}

        <div class="styled-pagination text-center">
            <ul>
                {% if data.page > 1 %}
                    <li><a class="prev" href="{{ data.dir }}?page={{ data.page - 1 }}{{ data.urlParams }}" data-page="{{ data.page - 1 }}"><i class="fa fa-chevron-left"></i></a></li>
                {% else %}
                    <li><a class="disabled" href="javascript:;"><i class="fa fa-chevron-left"></i></a></li>
                {% endif %}
                <li class="{% if data.page == 1 %}current{% endif %}"><a href="{{ data.dir }}?page=1{{ data.urlParams }}" data-page="1">1</a></li>

                {% if totalPages > 2 %}

                    {% set ellipsisLeft = 0 %}
                    {% set ellipsisRight = 0 %}

                    {% if totalPages > pagerButtons %}

                        {% if data.page >= pagerButtons %}
                            {% if totalPages > pagerButtons + 1 %}
                                {% set ellipsisLeft = 1 %}
                            {% endif %}
                            {% set ellipsisRight = 1 %}

                            {% set pStart = data.page - 2 %}
                            {% set pEnd = data.page + 2 %}

                            {% if data.page > totalPages - (pagerButtons - 1) %}
                                {% set ellipsisRight = 0 %}
                                {% set pStart = totalPages - (pagerButtons - 1) %}
                                {% set pEnd = totalPages - 1 %}
                            {% endif %}

                        {% else %}
                            {% set pStart = 2 %}

                            {% if totalPages > pagerButtons %}
                                {% set pEnd = pagerButtons %}
                                {% set ellipsisRight = 1 %}
                            {% else %}
                                {% set pEnd = totalPages - 1 %}
                            {% endif %}

                            {% if totalPages > pagerButtons + 1 %}
                                {% set ellipsisRight = 1 %}
                            {% endif %}

                        {% endif %}

                    {% else %}
                        {% set pStart = 2 %}
                        {% set pEnd = totalPages - 1 %}
                    {% endif %}

                    {% if ellipsisLeft == 1 %}
                        <li><a class="">...</a></li>
                    {% endif %}

                    {% for page in pStart..pEnd %}
                        <li class="{% if page == data.page %}current{% endif %}"><a href="{{ data.dir }}?page={{ page }}{{ data.urlParams }}" data-page="{{ page }}">{{ page }}</a></li>
                    {% endfor %}

                    {% if ellipsisRight == 1 %}
                        <li><a class="">...</a></li>
                    {% endif %}

                {% endif %}
                <li class="{% if totalPages == data.page %}current{% endif %}"><a href="{{ data.dir }}?page={{ totalPages }}{{ data.urlParams }}" data-page="{{ totalPages }}">{{ totalPages }}</a></li>

                {% if data.page < totalPages %}
                    <li class=""><a class="next" href="{{ data.dir }}?page={{ data.page + 1 }}{{ data.urlParams }}" data-page="{{ data.page + 1 }}"><i class="fa fa-chevron-right"></i></a></li>
                {% else %}
                    <li class=""><a class="disabled" href="javasript:;"><i class="fa fa-chevron-right"></i></a></li>
                {% endif %}
            </ul>
        </div>
    {% endif %}
{% endmacro %}

{% macro highlightItem(data) %}
    <div class="service-block">
        <div class="inner-box">
            <div class="image-box">
                <div class="services_frame"><svg viewBox="0 0 500 500"><path d="M488.5,274.5L488.5,274.5l1.8-0.5l-2,0.5c-2.4-8.7-4.5-16.9-4.5-24.5c0-8,2.3-16.5,4.7-25.5 c3.5-13,7.1-26.5,3.7-39.5c-3.6-13.2-13.5-23.1-23.1-32.7c-6.5-6.5-12.6-12.6-16.6-19.4c-3.9-6.8-6.1-15.2-8.5-24.1 c-3.5-13.1-7.1-26.7-16.7-36.3c-9.5-9.5-22.9-13.1-35.9-16.6c-9-2.4-17.5-4.6-24.4-8.7c-6.5-3.8-12.5-9.8-18.9-16.2 c-9.7-9.8-19.6-19.8-33.2-23.4c-13.5-3.7-27.3,0.1-40.4,3.7c-8.7,2.4-16.9,4.6-24.5,4.6c-8,0-16.5-2.3-25.5-4.7 c-9.3-2.5-18.8-5-28.1-5c-3.8,0-7.6,0.4-11.3,1.4C172,11.1,162,21.1,152.4,30.7c-6.5,6.5-12.6,12.6-19.4,16.6 c-6.8,3.9-15.2,6.1-24.1,8.5c-13.1,3.5-26.7,7.1-36.3,16.7c-9.5,9.5-13.1,23-16.6,36c-2.4,9-4.6,17.5-8.7,24.4 c-3.8,6.5-9.8,12.5-16.2,18.9c-9.8,9.7-19.7,19.6-23.4,33.2c-3.7,13.5,0.1,27.3,3.7,40.5c2.4,8.7,4.6,16.9,4.6,24.5 c0,8-2.3,16.5-4.6,25.5c-3.5,13-7.1,26.6-3.7,39.5c3.6,13.2,13.5,23.1,23.1,32.7c6.5,6.5,12.6,12.6,16.6,19.4 c3.9,6.8,6.1,15.1,8.5,24c3.5,13.1,7.1,26.8,16.7,36.4c9.5,9.5,23,13.1,35.9,16.6c9,2.4,17.5,4.6,24.4,8.7 c6.5,3.8,12.5,9.8,18.9,16.2c9.7,9.8,19.6,19.8,33.2,23.5c3.8,1,7.6,1.5,11.8,1.5c9.6,0,19.3-2.7,28.5-5.1c8.8-2.4,17-4.6,24.5-4.6 c8,0,16.5,2.3,25.5,4.6c13,3.6,26.6,7.1,39.5,3.7c13.2-3.6,23.1-13.5,32.7-23.1c6.5-6.5,12.6-12.6,19.4-16.6 c6.7-3.9,15.1-6.1,24-8.5c13.1-3.5,26.8-7.1,36.4-16.8c9.5-9.5,13.1-23,16.6-36c2.4-9,4.6-17.5,8.7-24.4c3.8-6.5,9.8-12.5,16.2-18.9 c9.8-9.7,19.9-19.7,23.6-33.3C495.7,301.4,494.4,287.7,488.5,274.5z"></path></svg></div>
                <figure class="image">
                    <a href="{{ data.url }}">
                        <img src="{{ data.thumbnail }}" alt="">
                    </a>
                </figure>
            </div>
            <h4 class="name mb-1">
                <a href="{{ data.url }}">
                    {{ data.name }}
                </a>
            </h4>
            <div class="price">
                {% if data.variants[0].price.discount > 0 and data.variants[0].price.value > data.variants[0].price.discount  %}
                    {{ _price(data.variants[0].price.discount, data.variants[0].price.currency) }}{% if data.variants[0].packaging.packageUnitName %}/{{ data.variants[0].packaging.packageUnitName }}{% endif %}{% if data.hasVariants %}{{ _('LBL_PRICE_FROM') }}{% endif %}
                {% else %}
                    {{ _price(data.variants[0].price.value, data.variants[0].price.currency) }}{% if data.variants[0].packaging.packageUnitName %}/{{ data.variants[0].packaging.packageUnitName }}{% endif %}{% if data.hasVariants %}{{ _('LBL_PRICE_FROM') }}{% endif %}
                {% endif %}
            </div>
        </div>
    </div>
{% endmacro %}

{% macro cartItemHeader(item) %}
<li class="cart-item cart-item-{{ item.id }}">
    <img src="{{ item.image }}" alt="{{ item.name }}" class="thumb" />
    <span class="item-name">
        {{ item.name }}
    </span>
    {% if item.variant %}
        <span class="text-muted">{{ item.variant }}</span>
    {% endif %}
    <span class="item-quantity">
        <span class="item-quantity-{{ item.id }}">{{ item.quantity.amount }} {{ item.quantity.unit }}</span> x
        <span class="item-price-{{ item.id }} item-price">{{ _price(item.price.value, item.price.currency) }}</span>
    </span>
    <a href="{{ item.url }}" class="product-detail"></a>
    <button class="remove-item" data-id="{{ item.id }}"><span class="fa fa-times"></span></button>
</li>
{% endmacro %}

{% macro pageSections(sections, addDividerImageId = 11, context) %}
    {% if sections %}
        {% for section in sections %}
            <section class="contact-section pt-3">
                <div class="auto-container">
                    <div class="sec-title text-center mb-1 mt-1">
                        <h2>{{ section.title }}</h2>
                        <div class="text">
                            {{ include(template_from_string(section.content)) }}
                        </div>
                    </div>
                    {% if addDividerImageId %}
                    <div class="cws_divider mt-5"><img src="{{ context.theme }}images/icons/divider_{{ addDividerImageId }}.png" alt=""></div>
                    {% endif %}
                </div>
            </section>
        {% endfor %}
    {% endif %}
{% endmacro %}

{% macro form(form, context) %}
    <form action="{{ form.action }}" method="post" id="{{ form.name }}-form" autocomplete="off" class="parsley-form"{% if form.upload is not empty %} enctype="multipart/form-data"{% endif %} data-modal="false">
        {% include "formBuilder.twig" %}
    </form>
{% endmacro %}

{% macro table(table, filterFormName) %}
    {% import _self as tools %}
    {% if table.form is not empty %}
        {% if table.formTemplate %}
            {% include table.formTemplate ~ constant('TWIG_FILE_EXTENSION') %}
        {% else %}
            {% if table.form.view is not empty %}
                {{ tools.view(table.form) }}
            {% else %}
                {{ tools.form(table.form) }}
            {% endif %}
        {% endif %}
    {% else %}
        {% if table.boxed %}
            {% include "table-boxed.twig" %}
        {% else %}
            {% include "table.twig" %}
        {% endif %}

        {% if table.inlineForm is not empty %}
            {{ tools.form(table.inlineForm) }}
        {% endif %}
    {% endif %}
{% endmacro %}

{% macro view(form) %}
    {% import "formBuilderMacros.twig" as formBuilder %}
    {% if form.title or form.toolsTemplate %}
        <div class="border-0 mb-3">
            {% if form.title %}
                <div class="float-left">
                    <h1 class="page-title text-secondary-d3 text-140 d-block">
                        {{ _(form.title) }}
                    </h1>
                    {% if form.subTitle %}
                        <h6 class="text-grey-l2 font-light">{{ form.subTitle }}</h6>
                    {% endif %}
                </div>
            {% endif %}
            {% if form.toolsTemplate %}
                <div class="float-right">
                    {% include form.toolsTemplate ~ ".twig" %}
                </div>
            {% endif %}
        </div>
        <div class="clearfix"></div>
    {% endif %}

    {% include form.view ~ '.twig' %}

    {% if form.buttons|length > 0 %}
        <div class="d-flex">
            <div class="justify-content-end ml-auto">
                {% for button in form.buttons %}
                    {% if button.showInViewer and not button.isHidden %}
                        {{ formBuilder.button(button) }}
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    {% endif %}
{% endmacro %}

{% macro form_header(table) %}
    {% import _self as tools %}

    {% if table.form %}
        <div class="text-muted mb-2">
            <i class="fas fa-angle-left"></i> <a href="{{ table.form.buttons.cancel.link }}" class="text-muted">{{ _(table.form.header.parent) }}</a>
        </div>

        {% if table.form.header.selectionText %}
            <h3>{{ table.form.header.selectionText|raw }}</h3>
        {% else %}
            <H3>
                {% if table.form.header.raw %}
                    {{ table.form.header.title|raw }}
                {% else %}
                    {{ _(table.form.header.title) }}
                {% endif %}
            </H3>
        {% endif %}

        {% if table.form.header.subtitle != '' %}
            <div class="subtitle">
                {% if table.form.header.raw %}{{ table.form.header.subtitle|raw }}{% else %}{{ _(table.form.header.subtitle) }}{% endif %}
            </div>
        {% endif %}
    {% else %}
        <h3>{{ _(table.header) }}</h3>
    {% endif %}

{% endmacro %}

{% macro table_cell(table_name, keyvalue, column, val, row, readonly = false, table = false) %}
    {% if column.type == 'number' %}<div{% if val > 0 %} class="text-success"{% elseif val < 0 %} class="text-danger"{% endif %}>{% endif %}
    {% if column.templatestring is not empty %}
        {{ include(template_from_string( column.templatestring )) }}
    {% elseif column.type == 'options' %}
        {% if column.options[val] is iterable %}
            {% if column.options[val].class is not empty %}<div class="btn btn-block btn-sm {{ column.options[val].class }}">{% endif %}
            {{ _(column.options[val].name) }}
            {% if column.options[val].class is not empty %}</div>{% endif %}
        {% elseif column.options[val] is not empty %}
            {{ _(column.options[val]) }}
        {% else %}
            {%  for opt in column.options %}
                {% if opt is iterable and opt[val] is not empty %}
                    {{ _(opt[val]) }}
                {% endif %}
            {% endfor %}
        {% endif %}
    {% elseif column.type == 'checkgroup' %}
        {% set val = val|split('|') %}
        {% for opt in val %}{% if opt is not empty %}{{ column.options[opt] }}, {% endif %}{% endfor %}
    {% elseif column.type == 'icon' %}
        <i class="fa fa-{{ column.icons[ val ] }}{% if column.colors %} text-{{ column.colors[val] }}{% endif %}"></i>
    {% else %}
        {{ val|raw }}{% if column.unit is not empty %} {{ column.unit|raw }}{% endif %}
    {% endif %}
    {% if column.type == 'number' %}</div>{% endif %}
{% endmacro %}

{% macro table_options(keyvalue, table, row) %}
    <div class="table-options">
        {% if table.optionTemplate is not empty %}
            {% include table.optionTemplate ~ constant('TWIG_FILE_EXTENSION') %}
        {% else %}
            {% if table.subTable %}
                {% if table.readonly %}
                    {% if table.view %}<a data-toggle="modal" data-target="#ajax-modal"{% if table.modalSize or table.viewModalSize %} data-size="{% if table.viewModalSize %}{{ table.viewModalSize }}{% else %}{{ table.modalSize }}{% endif %}"{% endif %} href="/ajax/forms/{% if table.viewForm %}{{ table.viewForm }}{% else %}{{ table.formName }}{% endif %}/{{ keyvalue }}/?view=1" class="btn btn-light btn-h-info" data-backdrop="static" data-keyboard="false"><i class="far fa-eye text-muted"></i></a>{% endif %}
                {% else %}
                    {% if table.view %}<a data-toggle="modal" data-target="#ajax-modal"{% if table.modalSize or table.viewModalSize %} data-size="{% if table.viewModalSize %}{{ table.viewModalSize }}{% else %}{{ table.modalSize }}{% endif %}"{% endif %} href="/ajax/forms/{% if table.viewForm %}{{ table.viewForm }}{% else %}{{ table.formName }}{% endif %}/{{ keyvalue }}/?view=1" class="btn btn-light h-info"><i class="far fa-eye"></i></a>{% endif %}
                    {% if table.edit and ((row['options'].edit is defined and row['options'].edit != false) or row['options'].edit is not defined) %}<a data-toggle="modal" data-target="#ajax-modal"{% if table.modalSize %} data-size="{{ table.modalSize }}"{% endif %} href="/ajax/forms/{{ table.formName }}/{{ keyvalue }}/{{ table.name }}/" class="btn btn-light h-info" data-backdrop="static" data-keyboard="false"><i class="far fa-edit"></i></a>{% endif %}
                {% endif %}
            {% else %}
                {% if table.readonly %}
                    {% if table.view %}<a href="{% if table.customUrl %}{{ table.customUrl|replace({'%keyvalue%': keyvalue, '%id%': row.__id }) }}{% else %}view|{{ table.name }}/{{ keyvalue }}/{% endif %}" class="btn btn-light h-info"><i class="far fa-eye"></i></a>{% endif %}
                {% else %}
                    {% if table.view %}<a href="view|{{ table.name }}/{{ keyvalue }}/" class="btn btn-light h-info"><i class="far fa-eye"></i></a>{% endif %}
                    {% if table.edit and ((row['options'].edit is defined and row['options'].edit != false) or row['options'].edit is not defined) %}<a href="edit|{{ table.name }}/{{ keyvalue }}/" class="btn btn-light h-info"><i class="far fa-edit"></i></a>{% endif %}
                {% endif %}
            {% endif %}

            {% if not table.readonly %}
                {% if table.copy %}<a data-confirm-action="tables.copy('{{ table.name }}', '{{ keyvalue }}')" href="#" data-toggle="modal" data-target="#confirm-delete" data-confirm-button="{{ _('BTN_COPY') }}" data-confirm-question="{{ _('CONFIRM_COPY_TABLE_RECORD')|e }}" data-title="{{ _('LBL_COPY_TABLE_RECORD_TITLE')|e }}" data-color="warning" class="btn btn-light h-warning"><i class="far fa-clone"></i></a>{% endif %}

                {% if table.delete and row['options'].delete != false %}
                    {% if table.deleteField %}
                        {% if row['options'].isDeleted %}
                            {% if table.undelete %}
                                <a data-confirm-action="tables.unDelete('{{ table.name }}', '{{ keyvalue }}')" href="#" data-toggle="modal" data-target="#confirm-delete" data-confirm-button="{{ _('BTN_UNARCHIVE') }}" data-confirm-question="{{ _('CONFIRM_UNARCHIVE_TABLE_RECORD')|e }}" class="btn btn-light h-danger"><i class="fa fa-undo"></i> </a>
                            {% endif %}
                        {% else %}
                            <a data-confirm-action="tables.delete('{{ table.name }}', '{{ keyvalue }}')" href="#" data-toggle="modal" data-target="#confirm-delete" data-confirm-button="{{ _('BTN_ARCHIVE') }}" data-confirm-question="{{ _('CONFIRM_ARCHIVE_TABLE_RECORD')|e }}" class="btn btn-light h-danger"><i class="fa fa-archive"></i> </a>
                        {% endif %}
                    {% else %}
                        <a data-confirm-action="tables.delete('{{ table.name }}', '{{ keyvalue }}')" href="#" data-toggle="modal" data-target="#confirm-delete" data-confirm-question="{{ _('CONFIRM_DELETE_TABLE_RECORD')|e }}" class="btn btn-light h-danger"><i class="far fa-trash-alt"></i></a>
                    {% endif %}
                {% endif %}
            {% endif %}
        {% endif %}

        {% if table.additionalOptionsTemplate is not empty %}
            {% include table.additionalOptionsTemplate ~ constant('TWIG_FILE_EXTENSION') %}
        {% endif %}
    </div>
{% endmacro %}

{% macro infinite_scroll(id, container, current, pagenum, url, callback) %}
    <div id="{{ id }}" class="infinite_scroll text-center{% if current == pagenum %} hidden{% endif %}" data-container="{{ container }}" data-current="{{ current }}" data-pagenum="{{ pagenum }}"{% if url != '' %} data-url="{{ url }}"{% endif %}{% if callback != '' %} data-callback="{{ callback }}"{% endif %}>
        <i class="fas fa-circle-notch fa-spin text-muted"></i>
    </div>
{% endmacro %}